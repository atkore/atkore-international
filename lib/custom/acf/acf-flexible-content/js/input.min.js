/*
*  Flexible Content
*
*  @description: 
*  @since: 3.5.8
*  @created: 17/01/13
*/(function(e){acf.fields.flexible_content={add_sortable:function(){},update_order:function(){},add_layout:function(){},remove_layout:function(){}};var t=acf.fields.flexible_content;t.add_sortable=function(n){n.children(".values").unbind("sortable").sortable({items:"> .layout",handle:"> .menu-item-handle",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,start:function(t,n){e(document).trigger("acf/sortable_start",n.item);e(document).trigger("acf/sortable_start_flex",n.item)},stop:function(r,i){e(document).trigger("acf/sortable_stop",i.item);e(document).trigger("acf/sortable_stop_flex",i.item);t.update_order(n)}})};t.update_order=function(t){t.find("> .values .layout").each(function(t){e(this).find("> .menu-item-handle .fc-layout-order").html(t+1)})};t.add_layout=function(n,r){var i=acf.helpers.uniqid(),s=r.find('> .clones > .layout[data-layout="'+n+'"]').html().replace(/(=["]*[\w-\[\]]*?)(acfcloneindex)/g,"$1"+i),o=e('<div class="layout" data-layout="'+n+'"></div>').append(s);r.children(".no_value_message").hide();r.children(".values").append(o);e(document).trigger("acf/setup_fields",o);t.update_order(r);r.closest(".field").removeClass("error")};t.remove_layout=function(t){var n=t.closest(".acf_flexible_content"),r=e('<div style="height:'+t.height()+'px"></div>');t.addClass("acf-remove-item");setTimeout(function(){t.before(r).remove();r.animate({height:0},250,function(){r.remove()});n.children(".values").children(".layout").exists()||n.children(".no_value_message").show()},400)};e(document).live("acf/setup_fields",function(n,r){e(r).find(".acf_flexible_content").each(function(){var n=e(this);t.add_sortable(n);e(n).find(".layout").each(function(){acf.fields.repeater.set_column_widths(e(this))})})});e(".acf_flexible_content .flexible-footer .add-row-end").live("click",function(){e(this).trigger("focus")}).live("focus",function(){e(this).siblings(".acf-popup").addClass("active")}).live("blur",function(){var t=e(this);setTimeout(function(){t.siblings(".acf-popup").removeClass("active")},250)});e(".acf_flexible_content .fc-delete-layout").live("click",function(){var n=e(this).closest(".layout");t.remove_layout(n);return!1});e(".acf_flexible_content .acf-popup ul li a").live("click",function(){var n=e(this).attr("data-layout"),r=e(this).closest(".acf_flexible_content");t.add_layout(n,r);return!1});e(".acf_flexible_content .layout .menu-item-handle").live("click",function(){var t=e(this).closest(".layout");if(t.attr("data-toggle")=="closed"){t.attr("data-toggle","open");t.children(".acf-input-table").show()}else{t.attr("data-toggle","closed");t.children(".acf-input-table").hide()}})})(jQuery);