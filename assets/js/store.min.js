// Copyright 2012 Google Inc.
/**
 * @author Chris Broadfoot (Google)
 * @fileoverview
 * Store model class for Store Locator library.
 *//**
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * Represents a store.
 * @example <pre>
 * var latLng = new google.maps.LatLng(40.7585, -73.9861);
 * var store = new storeLocator.Store('times_square', latLng, null);
 * </pre>
 * <pre>
 * var features = new storeLocator.FeatureSet(
 *     view.getFeatureById('24hour'),
 *     view.getFeatureById('express'),
 *     view.getFeatureById('wheelchair_access'));
 *
 * var store = new storeLocator.Store('times_square', latLng, features, {
 *   title: 'Times Square',
 *   address: '1 Times Square&lt;br>Manhattan, NY 10036'
 * });
 * </pre>
 * <pre>
 * store.distanceTo(map.getCenter());
 *
 * // override default info window
 * store.getInfoWindowContent = function() {
 *   var details = this.getDetails();
 *   return '&lt;h1>' + details.title + '&lt;h1>' + details.address;
 * };
 * </pre>
 * @param {string} id globally unique id of the store - should be suitable to
 * use as a HTML id.
 * @param {!google.maps.LatLng} location location of the store.
 * @param {storeLocator.FeatureSet} features the features of this store.
 * @param {Object.<string, *>=} props any additional properties.
 * <p> Recommended fields are:
 *      'title', 'address', 'phone', 'misc', 'web'. </p>
 * @constructor
 * @implements storeLocator_Store
 */storeLocator.Store=function(e,t,n,r){this.id_=e;this.location_=t;this.features_=n||storeLocator.FeatureSet.NONE;this.props_=r||{}};storeLocator.Store=storeLocator.Store;storeLocator.Store.prototype.setMarker=function(e){this.marker_=e;google.maps.event.trigger(this,"marker_changed",e)};storeLocator.Store.prototype.getMarker=function(){return this.marker_};storeLocator.Store.prototype.getId=function(){return this.id_};storeLocator.Store.prototype.getLocation=function(){return this.location_};storeLocator.Store.prototype.getFeatures=function(){return this.features_};storeLocator.Store.prototype.hasFeature=function(e){return this.features_.contains(e)};storeLocator.Store.prototype.hasAllFeatures=function(e){if(!e)return!0;var t=e.asList();for(var n=0,r=t.length;n<r;n++)if(!this.hasFeature(t[n]))return!1;return!0};storeLocator.Store.prototype.getDetails=function(){return this.props_};storeLocator.Store.prototype.generateFieldsHTML_=function(e){var t=[];for(var n=0,r=e.length;n<r;n++){var i=e[n];if(this.props_[i]){t.push('<div class="');t.push(i);t.push('">');t.push(this.props_[i]);t.push("</div>")}}return t.join("")};storeLocator.Store.prototype.generateFeaturesHTML_=function(){var e=[];e.push('<ul class="features">');var t=this.features_.asList();for(var n=0,r;r=t[n];n++){e.push("<li>");e.push(r.getDisplayName());e.push("</li>")}e.push("</ul>");return e.join("")};storeLocator.Store.prototype.getInfoWindowContent=function(){if(!this.content_){var e=["title","address","phone","misc","web"],t=['<div class="store">'];t.push(this.generateFieldsHTML_(e));t.push(this.generateFeaturesHTML_());t.push("</div>");this.content_=t.join("")}return this.content_};storeLocator.Store.prototype.getInfoPanelContent=function(){return this.getInfoWindowContent()};storeLocator.Store.infoPanelCache_={};storeLocator.Store.prototype.getInfoPanelItem=function(){var e=storeLocator.Store.infoPanelCache_,t=this,n=t.getId();if(!e[n]){var r=t.getInfoPanelContent();e[n]=$('<li class="store" id="store-'+t.getId()+'">'+r+"</li>")[0]}return e[n]};storeLocator.Store.prototype.distanceTo=function(e){var t=6371,n=this.getLocation(),r=storeLocator.toRad_(n.lat()),i=storeLocator.toRad_(n.lng()),s=storeLocator.toRad_(e.lat()),o=storeLocator.toRad_(e.lng()),u=s-r,a=o-i,f=Math.sin(u/2)*Math.sin(u/2)+Math.cos(r)*Math.cos(s)*Math.sin(a/2)*Math.sin(a/2),l=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f));return t*l};