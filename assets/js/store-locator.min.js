(function(e){function L(e){return function(){return this[e]}}function O(){}function M(e){return e*i.PI/180}function _(e,t){this.b=e;this.a=t}function D(e){this.a=[];this.b={};for(var t=0,n;n=arguments[t];t++)this.add(n)}function H(r,i){this.g=e(r);this.g[y]("storelocator-panel");this.c=e.extend({locationSearch:t,locationSearchLabel:"Where are you?",featureFilter:t,directions:t,view:n},i);this.l=new google[d].DirectionsRenderer({draggable:t});this.t=new google[d].DirectionsService;B(this)}function B(t){t.c.view&&t.set("view",t.c.view);t.e=e('<form class="storelocator-filter"/>');t.g[C](t.e);t.c.locationSearch&&(t.i=e('<div class="location-search"><h4>'+t.c.locationSearchLabel+"</h4><input></div>"),t.e[C](t.i),"undefined"!=typeof google[d].places?I(t):t.e.submit(function(){t.searchPosition(e("input",t.i).val())}),t.e.submit(function(){return r}),google[d][k][p](t,"geocode",function(e){t.s&&window.clearTimeout(t.s);if(e[f]){this.k=e[f].location;t.h&&q(t);var r=t.get("view");r[w](n);var i=r[v]();e[f].viewport?i.fitBounds(e[f].viewport):(i.setCenter(e[f].location),i.setZoom(13));r.refreshView();F(t)}else t.searchPosition(e.name)}));if(t.c.featureFilter){t.d=e('<div class="feature-filter"/>');for(var i=t.get("view").getFeatures().asList(),s=0,o=i[E];s<o;s++){var u=i[s],a=e('<input type="checkbox"/>');a.data("feature",u);e("<label/>")[C](a)[C](u.getDisplayName()).appendTo(t.d)}t.e[C](t.d);t.d[h]("input").change(function(){var n=e(this).data("feature"),r=t.get("featureFilter");r.toggle(n);t.set("featureFilter",r);t.get("view").refreshView()})}t.b=e('<ul class="store-list"/>');t.g[C](t.b);t.c.directions&&(t.a=e('<div class="directions-panel"><form><input class="directions-to"/><input type="submit" value="Find directions"/><a href="#" class="close-directions">Close</a></form><div class="rendered-directions"></div></div>'),t.a[h](".directions-to")[l]("readonly","readonly"),t.a.hide(),t.h=r,t.a[h]("form").submit(function(){q(t);return r}),t.a[h](".close-directions")[b](function(){t.hideDirections()}),t.g[C](t.a))}function F(e){var t=e.get("view");e.r&&google[d][k][a](e.r);e.r=google[d][k].addListenerOnce(t,"stores_changed",function(){e.set("stores",t.get("stores"))})}function I(t){var n=e("input",t.i)[0];t.f=new google[d].places.Autocomplete(n);t.get("view")&&t.f[u]("bounds",t.get("view")[v]());google[d][k][p](t.f,"place_changed",function(){google[d][k][o](t,"geocode",this.getPlace())})}function q(e){if(e.k&&e.m){var t=e.a[h](".rendered-directions").empty();e.t.route({origin:e.k,destination:e.m[s](),travelMode:google[d].DirectionsTravelMode.DRIVING},function(n,r){if(r==google[d].DirectionsStatus.OK){var i=e.l;i.setPanel(t[0]);i[N](e.get("view")[v]());i.setDirections(n)}})}}function R(){this.b=[]}function U(e,t){t.sort(function(t,n){return t.distanceTo(e)-n.distanceTo(e)})}function z(e,t,n,r){this.f=e;this.d=t;this.a=n||P;this.b=r||{}}function W(e){for(var t=["title","address","phone","misc","web"],n=[],r=0,i=t[E];r<i;r++){var s=t[r];e.b[s]&&(n[g]('<div class="'),n[g](s),n[g]('">'),n[g](e.b[s]),n[g]("</div>"))}return n.join("")}function X(e){var t=[];t[g]('<ul class="features">');for(var e=e.a.asList(),n=0,r;r=e[n];n++)t[g]("<li>"),t[g](r.getDisplayName()),t[g]("</li>");t[g]("</ul>");return t.join("")}function $(){}function J(n,r,i){this.g=n;this.f=r;this.b=e.extend({updateOnPan:t,geolocation:t,features:new D},i);Q(this);google[d][k][o](this,"load");this.set("featureFilter",new D)}function K(e){window.navigator&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){t=new google[d].LatLng(t.coords.latitude,t.coords.longitude);e[v]().setCenter(t);e[v]().setZoom(11);google[d][k][o](e,"load")},void 0,{maximumAge:6e4,timeout:1e4})}function Q(e){e.b.geolocation&&K(e);e.c={};e.a=new google[d].InfoWindow;var t=e[v]();e.set("updateOnPan",e.b.updateOnPan);google[d][k][p](e.a,"closeclick",function(){e[w](n)});google[d][k][p](t,"click",function(){e[w](n);e.a.close()})}var t=!0,n=null,r=!1,i=Math,s="getLocation",o="trigger",u="bindTo",a="removeListener",f="geometry",l="attr",c="getBounds",h="find",p="addListener",d="maps",v="getMap",m="contains",g="push",y="addClass",b="click",w="highlight",E="length",S="prototype",x="getId",T="getMarker",N="setMap",C="append",k="event",A;window.storeLocator=O;O.Feature=_;_[S].getId=L("b");_[S].getDisplayName=L("a");_[S].toString=function(){return this.getDisplayName()};O.FeatureSet=D;A=D[S];A.toggle=function(e){this[m](e)?this.remove(e):this.add(e)};A.contains=function(e){return e[x]()in this.b};A.getById=function(e){return e in this.b?this.a[this.b[e]]:n};A.add=function(e){e&&(this.a[g](e),this.b[e[x]()]=this.a[E]-1)};A.remove=function(e){this[m](e)&&(this.a[this.b[e[x]()]]=n,delete this.b[e[x]()])};A.asList=function(){for(var e=[],t=0,r=this.a[E];t<r;t++){var i=this.a[t];i!==n&&e[g](i)}return e};var P=new D;O.Panel=H;H.prototype=new google[d].MVCObject;var j=new google[d].Geocoder;A=H[S];A.searchPosition=function(e){var t=this,e={address:e,bounds:this.get("view")[v]()[c]()};j.geocode(e,function(e,n){n==google[d].GeocoderStatus.OK&&google[d][k][o](t,"geocode",e[0])})};A.setView=function(e){this.set("view",e)};A.view_changed=function(){function e(){t.clearMarkers();F(n)}var t=this.get("view");this[u]("selectedStore",t);var n=this;this.o&&google[d][k][a](this.o);this.q&&google[d][k][a](this.q);this.p&&google[d][k][a](this.p);t[v]();this.o=google[d][k][p](t,"load",e);this.q=google[d][k][p](t[v](),"zoom_changed",e);this.p=google[d][k][p](t[v](),"idle",function(){var e=t[v]();n.j?e[c]()[m](n.j)||(n.j=e.getCenter(),F(n)):n.j=e.getCenter()});e();this[u]("featureFilter",t);this.f&&this.f[u]("bounds",t[v]())};A.stores_changed=function(){if(this.get("stores")){var n=this.get("view"),r=n&&n[v]()[c](),o=this.get("stores"),u=this.get("selectedStore");this.b.empty();o[E]?r&&!r[m](o[0][s]())&&this.b[C]('<li class="no-stores">There are no stores in this area. However, stores closest to you are listed below.</li>'):this.b[C]('<li class="no-stores">There are no stores in this area.</li>');for(var r=function(){n[w](this.store,t)},a=0,f=i.min(10,o[E]);a<f;a++){var l=o[a].getInfoPanelItem();l.store=o[a];u&&o[a][x]()==u[x]()&&e(l)[y]("highlighted");l.u||(l.u=google[d][k].addDomListener(l,"click",r));this.b[C](l)}}};A.selectedStore_changed=function(){e(".highlighted",this.b).removeClass("highlighted");var n=this,i=this.get("selectedStore");if(i){this.m=i;this.b[h]("#store-"+i[x]())[y]("highlighted");this.c.directions&&this.a[h](".directions-to").val(i.getDetails().title);var o=n.get("view").getInfoWindow().getContent(),u=e("<a/>").text("Directions")[l]("href","#")[y]("action")[y]("directions"),a=e("<a/>").text("Zoom here")[l]("href","#")[y]("action")[y]("zoomhere"),f=e("<a/>").text("Street view")[l]("href","#")[y]("action")[y]("streetview");u[b](function(){n.showDirections();return r});a[b](function(){n.get("view")[v]().setOptions({center:i[s](),zoom:16})});f[b](function(){var e=n.get("view")[v]().getStreetView();e.setPosition(i[s]());e.setVisible(t)});e(o)[C](u)[C](a)[C](f)}};A.hideDirections=function(){this.h=r;this.a.fadeOut();this.d.fadeIn();this.b.fadeIn();this.l[N](n)};A.showDirections=function(){var e=this.get("selectedStore");this.d.fadeOut();this.b.fadeOut();this.a[h](".directions-to").val(e.getDetails().title);this.a.fadeIn();q(this);this.h=t};A.featureFilter_changed=function(){F(this)};O.StaticDataFeed=R;R[S].setStores=function(e){this.b=e;this.a?this.a():delete this.a};R[S].getStores=function(e,t,n){if(this.b[E]){for(var r=[],i=0,s;s=this.b[i];i++)s.hasAllFeatures(t)&&r[g](s);U(e.getCenter(),r);n(r)}else{var o=this;this.a=function(){o.getStores(e,t,n)}}};O.Store=z;A=z[S];A.setMarker=function(e){this.e=e;google[d][k][o](this,"marker_changed",e)};A.getMarker=L("e");A.getId=L("f");A.getLocation=L("d");A.getFeatures=L("a");A.hasFeature=function(e){return this.a[m](e)};A.hasAllFeatures=function(e){if(!e)return t;for(var e=e.asList(),n=0,i=e[E];n<i;n++)if(!this.hasFeature(e[n]))return r;return t};A.getDetails=L("b");A.getInfoWindowContent=function(){if(!this.c){var e=['<div class="store">'];e[g](W(this));e[g](X(this));e[g]("</div>");this.c=e.join("")}return this.c};A.getInfoPanelContent=function(){return this.getInfoWindowContent()};var V={};z[S].getInfoPanelItem=function(){var t=this[x]();if(!V[t]){var n=this.getInfoPanelContent();V[t]=e('<li class="store" id="store-'+this[x]()+'">'+n+"</li>")[0]}return V[t]};z[S].distanceTo=function(e){var t=this[s](),n=M(t.lat()),r=M(t.lng()),t=M(e.lat()),o=M(e.lng()),e=t-n,r=o-r,n=i.sin(e/2)*i.sin(e/2)+i.cos(n)*i.cos(t)*i.sin(r/2)*i.sin(r/2);return 12742*i.atan2(i.sqrt(n),i.sqrt(1-n))};O.DataFeed=$;$[S].getStores=function(){};O.View=J;J.prototype=new google[d].MVCObject;A=J[S];A.updateOnPan_changed=function(){this.e&&google[d][k][a](this.e);if(this.get("updateOnPan")&&this[v]()){var e=this,t=this[v]();this.e=google[d][k][p](t,"idle",function(){e.refreshView()})}};A.addStoreToMap=function(e){var t=this[T](e);e.setMarker(t);var n=this;t.n=google[d][k][p](t,"click",function(){n[w](e,r)});t[v]()!=this[v]()&&t[N](this[v]())};A.createMarker=function(e){var e={position:e[s]()},t=this.b.markerIcon;t&&(e.icon=t);return new google[d].Marker(e)};A.getMarker=function(e){var t=this.c,n=e[x]();t[n]||(t[n]=this.createMarker(e));return t[n]};A.getInfoWindow=function(t){if(!t)return this.a;this.a.setContent(e(t.getInfoWindowContent())[0]);return this.a};A.getFeatures=function(){return this.b.features};A.getFeatureById=function(e){if(!this.d){this.d={};for(var t=0,n;n=this.b.features[t];t++)this.d[n[x]()]=n}return this.d[e]};A.featureFilter_changed=function(){google[d][k][o](this,"featureFilter_changed",this.get("featureFilter"));this.get("stores")&&this.clearMarkers()};A.clearMarkers=function(){for(var e in this.c){this.c[e][N](n);var t=this.c[e].n;t&&google[d][k][a](t)}};A.refreshView=function(){var e=this;this.f.getStores(this[v]()[c](),this.get("featureFilter"),function(t){var n=e.get("stores");if(n)for(var r=0,i=n[E];r<i;r++)google[d][k][a](n[r][T]().n);e.set("stores",t)})};A.stores_changed=function(){for(var e=this.get("stores"),t=0,n;n=e[t];t++)this.addStoreToMap(n)};A.getMap=L("g");A.highlight=function(e,t){var n=this.getInfoWindow(e);e?(n=this.getInfoWindow(e),e[T]()?n.open(this[v](),e[T]()):(n.setPosition(e[s]()),n.open(this[v]())),t&&this[v]().panTo(e[s]()),this[v]().getStreetView().getVisible()&&this[v]().getStreetView().setPosition(e[s]())):n.close();this.set("selectedStore",e)};A.selectedStore_changed=function(){google[d][k][o](this,"selectedStore_changed",this.get("selectedStore"))}})(jQuery);